# ADR-0003: Uso do Ktor Server como backend de Staging

## Status

Aceito ✅

## Contexto

O projeto **Play Learn Grow / Plalegro App** possui duas frentes principais:

- **Android (Compose)** que consome diretamente o módulo `shared` (KMP).
- **Web (Next.js)** que precisa consumir lógica de negócio validada em staging.

Para garantir consistência e evitar duplicação de regras, decidimos expor os casos de uso do `shared` via **API REST**.  
O backend precisa ser leve, multiplataforma, fácil de integrar com KMP e com suporte moderno a JSON.

## Decisão

Adotar **Ktor Server** como backend de staging:

- Servidor leve e idiomático em Kotlin.
- Integração direta com o módulo `shared` (use cases, DTOs).
- Suporte nativo a **ContentNegotiation** e **kotlinx.serialization**.
- Deploy simples em containers ou ambientes cloud (Heroku, Fly.io, Kubernetes).

Endpoints principais:

- `POST /registerUser` → cria usuário.
- `POST /createChild` → cria perfil de criança.
- `POST /defineContentPack` → define pacote de conteúdo.
- `GET /health` → health-check para CI/CD.

## Consequências

- **Positivas:**
  - Reuso da lógica do `shared` sem duplicação.
  - Next.js consome API REST consistente.
  - QA pode validar staging com dados reais.
  - Fácil evolução para produção (mesma base de código).
- **Negativas:**
  - Introduz mais um serviço para manter.
  - Necessidade de DevOps para deploy e monitoramento.
  - Latência adicional entre Next.js e backend.

## Alternativas consideradas

- **Spring Boot:** rejeitado por ser mais pesado e não tão integrado com KMP.
- **Micronaut/Quarkus:** boas opções, mas menos idiomáticas para multiplataforma.
- **Node.js backend:** rejeitado por duplicar lógica em TypeScript.

## Decisão final

O **Ktor Server** será usado como backend de staging, expondo APIs REST que consomem diretamente o módulo `shared`.  
Next.js consumirá essas APIs em staging, garantindo consistência e validando features antes de produção.

# ADR-0002: Adoção estratégica de Kotlin Multiplatform (KMP)

## Status
Planejado ✅ (piloto em módulos compartilháveis)

## Contexto
O projeto possui duas frentes: **Android (Kotlin)** e **Web (Next.js)**. Há lógica de negócio que pode ser compartilhada entre plataformas (validações, entidades, casos de uso, serialização, repositórios). Manter essas regras duplicadas em cada stack aumenta custo de manutenção e risco de inconsistência.

## Decisão
Adotar **Kotlin Multiplatform (KMP)** para compartilhar:
- Value objects, entidades e casos de uso (módulo `:core` evolui para `:shared`).
- Serviços comuns (serialização, formatação, regras de negócio).
- Repositórios e datasources com `expect/actual` para plataformas específicas.

Arquitetura:
- `shared/` (KMP): domínio, use cases, interfaces de repositórios, DTOs, serialização, utils.
- `androidApp/` (Compose): `actual` para storage, network e clock.
- `webApp/` (Next.js + WASM/NPM ou backend Kotlin + API para consumo): integração gradativa (primeiro consumo via REST; depois KMP distribuído como pacote npm quando viável).

## Consequências
- Positivas:
  - Reuso real da lógica de negócio entre Android e Web.
  - Menos bugs por divergência de regras.
  - Testes unificados em `shared`.
- Negativas:
  - Complexidade inicial (tooling KMP, publicação).
  - Integração com Next.js exigirá estratégia (REST ou KMP como lib Web/WASM).

## Alternativas consideradas
- Duplicar lógica: rejeitado por custos e riscos.
- Apenas REST: bom para integração, mas não compartilha regras internas.
- Monorepo sem KMP: mantém stacks distintos sem reuso suficiente.

## Plano de migração
1. Criar módulo `shared` KMP com domínio e use cases.
2. Introduzir `expect/actual` para data, storage e network.
3. Adaptar `androidApp` para usar `shared`.
4. Expor API REST para `webApp` consumir até viabilizar KMP/WASM.
5. Medir cobertura de testes e performance.

## Critérios de sucesso
- ≥80% das regras de negócio no `shared`.
- Testes multiplataforma rodando no CI.
- Android usando `shared` em produção.
- Web consumindo a mesma lógica via REST ou lib KMP (quando possível).
